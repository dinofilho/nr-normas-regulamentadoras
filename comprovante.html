<!DOCTYPE html><html lang="pt-BR"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Comprovante de Avaliação</title>
<style>
  :root{--bg:#f8fafc;--card:#fff;--b:#e5e7eb;--text:#0f172a;--muted:#64748b;--ok:#065f46}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',sans-serif;background:var(--bg);margin:0;color:var(--text)}
  .wrap{max-width:920px;margin:32px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--b);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05);padding:22px}
  h1{margin:0 0 14px;font-size:26px}
  .grid{display:grid;grid-template-columns:1fr 2fr;gap:10px 14px;margin-top:10px}
  .label{color:var(--muted)}
  .val{font-weight:600}
  .nota{margin-top:18px;font-size:22px;color:var(--ok);font-weight:700}
  .row{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
  .btn{background:#2563eb;color:#fff;border:0;border-radius:10px;padding:12px 18px;font-weight:600;cursor:pointer}
  .muted{color:var(--muted);font-size:12px;margin-top:8px}
  @media print {.btn,.muted{display:none}}
</style>
</head><body>
<div class="wrap">
  <div class="card">
    <h1>Comprovante de Avaliação</h1>

    <div class="grid">
      <div class="label">Aluno:</div><div id="aluno" class="val">—</div>
      <div class="label">CPF:</div><div id="cpf" class="val">—</div>
      <div class="label">Curso/NR:</div><div id="curso" class="val">—</div>
      <div class="label">Data da avaliação:</div><div id="data" class="val">—</div>
    </div>

    <div id="notaBox" class="nota">Nota: —</div>

    <div class="row">
      <button class="btn" onclick="window.print()">Imprimir / Salvar PDF</button>
    </div>
    <div class="muted">Este comprovante foi gerado automaticamente.</div>
  </div>
</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const qs = new URLSearchParams(location.search);

  // Preferência: parâmetros da URL enviados pelo quiz
  const alunoURL = qs.get('nome');
  const cpfURL   = qs.get('cpf');
  const cursoURL = qs.get('curso');   // ex.: "NR-20"
  const notaURL  = qs.get('nota');    // ex.: "80"
  const emailURL = qs.get('email');   // se precisar

  // Fallback: localStorage (auto-grade.js)
  const alunoLS = localStorage.getItem('aluno');
  const cpfLS   = localStorage.getItem('cpf');
  const nrLS    = localStorage.getItem('nr'); // "NR-20"
  const notaLS  = localStorage.getItem('nota');
  const dataISO = (localStorage.getItem('dataAvaliacaoISO') || '').trim(); // yyyy-mm-dd

  function iso2br(iso){
    if(!iso || !/^\d{4}-\d{2}-\d{2}$/.test(iso)) return '';
    const [Y,M,D] = iso.split('-'); return `${D}/${M}/${Y}`;
  }
  function hojeBR(){
    const d=new Date();
    const dd=String(d.getDate()).padStart(2,'0');
    const mm=String(d.getMonth()+1).padStart(2,'0');
    const yy=d.getFullYear();
    return `${dd}/${mm}/${yy}`;
  }

  // Preenche dados
  const aluno = alunoURL || alunoLS || '—';
  const cpf   = cpfURL   || cpfLS   || '—';
  const curso = (cursoURL || nrLS || '—').toUpperCase();
  const data  = iso2br(qs.get('dataAvaliacaoISO') || dataISO) || hojeBR();
  const nota  = (notaURL || notaLS || '').toString();

  $('aluno').textContent = aluno;
  $('cpf').textContent   = cpf;
  $('curso').textContent = curso;
  $('data').textContent  = data;

  $('notaBox').textContent = nota ? `Nota: ${nota}` : 'Nota: —';

  // Se quiser guardar o último comprovante:
  try {
    localStorage.setItem('lastComprovante', JSON.stringify({aluno, cpf, curso, data, nota}));
  } catch(e){}
})();
</script>
</body></html>

